#!/usr/bin/env node

var getopts = require('getopts-compat');

var options = getopts(process.argv.slice(2), {
  alias: { engines: 'e', range: 'r', versions: 'v', silent: 's' },
  default: { range: 'major,even' },
  boolean: ['engines', 'cache', 'silent'],
  stopEarly: true,
});

// define.option('-e, --engines', 'use engines version range');
// define.option('-r, --range [range]', 'range type of major, minor, or patch with filters of lts, even, odd for version string expressions', 'major,even');
// define.option('-v, --versions [version]', 'comma-separated list of versions to run against', function (string) {
//   return string.split(',');
// });
// define.option('-s, --silent', 'suppress logging', false);
if (typeof options.versions === 'string') options.versions = options.versions.split(',');

var args = options._;
if (args.length < 1) {
  console.log('Missing command. Example usage: nvs --versions 0.10,4,6,14 [command]');
  return process.exit(-1);
}

var assign = require('object-assign');
var isArray = require('is-array');
var nvs = require('..');

nvs(args[0], args.slice(1), assign({ stdio: 'inherit' }, options), function (err, results) {
  if (err) {
    if (!isArray(err)) err = [err];
    for (var index = 0; index < err.length; err++) {
      console.log(err[index].message);
    }
    return process.exit(-1);
  }
  process.exit(0);
});
